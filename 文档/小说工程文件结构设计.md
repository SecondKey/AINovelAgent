# 小说工程文件结构设计

## 概述

本文档详细描述了AINovelAgent项目支持的小说工程文件结构。该结构基于纯文件系统设计，无需数据库，支持多媒体文件管理，完全可移植和协作友好。

## 核心设计原则

- **文件驱动**: 完全基于文件系统，无需数据库
- **可读性**: 所有文件都支持直接编辑和阅读
- **可移植性**: 支持跨平台使用和版本控制
- **多媒体支持**: 天然支持图片、音频、视频等多媒体文件
- **模块化**: 清晰的文件组织结构，便于管理和扩展
- **协作友好**: 支持多用户共享和编辑

## 完整文件结构

```
Novels/                                    # 小说工程根目录
├── 小说工程1/                            # 每部小说独立文件夹
│   ├── ProjectSettings.xml               # 项目设置文件
│   ├── outline.xml                       # 章节大纲（XML格式）
│   ├── timeline.xml                      # 时间线（XML格式）
│   ├── settings.xml                      # 世界观设定（XML格式）
│   ├── metadata.json                     # 元数据（JSON格式）
│   ├── writing_guidelines.xml            # 写作指导规则
│   ├── analysis_results.xml              # AI分析结果
│   ├── creation_log.xml                  # 创作日志
│   ├── Concepts/                         # 概念文件夹（统一管理所有概念实体）
│   │   ├── Characters/                   # 角色文件夹
│   │   │   ├── 角色1/                   # 每个角色独立文件夹
│   │   │   │   ├── info.xml             # 角色基本信息
│   │   │   │   ├── avatar.jpg           # 角色头像
│   │   │   │   ├── reference/           # 参考图片文件夹
│   │   │   │   ├── timeline.xml         # 角色时间线
│   │   │   │   ├── events.xml           # 角色事件记录
│   │   │   │   ├── relationships.xml    # 角色关系网络
│   │   │   │   ├── development.xml      # 角色发展轨迹
│   │   │   │   └── dialogue_samples.xml # 对话样本
│   │   │   └── 角色2/
│   │   │       └── ...
│   │   ├── Factions/                     # 势力文件夹
│   │   │   ├── 势力1/                   # 每个势力独立文件夹
│   │   │   │   ├── info.xml             # 势力基本信息
│   │   │   │   ├── logo.png             # 势力标志
│   │   │   │   ├── banner.jpg           # 势力横幅
│   │   │   │   ├── members.xml          # 成员列表
│   │   │   │   ├── timeline.xml         # 势力时间线
│   │   │   │   ├── events.xml           # 势力事件记录
│   │   │   │   ├── hierarchy.xml        # 势力层级结构
│   │   │   │   ├── territories.xml      # 势力领地
│   │   │   │   └── policies.xml         # 势力政策
│   │   │   └── 势力2/
│   │   │       └── ...
│   │   ├── Locations/                    # 地点文件夹
│   │   │   ├── 地点1/                   # 每个地点独立文件夹
│   │   │   │   ├── info.xml             # 地点基本信息
│   │   │   │   ├── images/              # 地点图片
│   │   │   │   ├── description.xml      # 地点描述
│   │   │   │   ├── history.xml          # 地点历史
│   │   │   │   ├── connections.xml      # 地点连接关系
│   │   │   │   └── events.xml           # 地点相关事件
│   │   │   └── 地点2/
│   │   │       └── ...
│   │   ├── Items/                        # 物品文件夹
│   │   │   ├── 物品1/                   # 每个物品独立文件夹
│   │   │   │   ├── info.xml             # 物品基本信息
│   │   │   │   ├── images/              # 物品图片
│   │   │   │   ├── description.xml      # 物品描述
│   │   │   │   ├── properties.xml       # 物品属性
│   │   │   │   ├── history.xml          # 物品历史
│   │   │   │   └── owners.xml           # 物品拥有者
│   │   │   └── 物品2/
│   │   │       └── ...
│   │   ├── Themes/                       # 主题文件夹
│   │   │   ├── 主题1/                   # 每个主题独立文件夹
│   │   │   │   ├── info.xml             # 主题基本信息
│   │   │   │   ├── description.xml      # 主题描述
│   │   │   │   ├── examples.xml         # 主题示例
│   │   │   │   ├── development.xml      # 主题发展
│   │   │   │   └── connections.xml      # 主题关联
│   │   │   └── 主题2/
│   │   │       └── ...
│   │   ├── Organizations/                # 组织文件夹（扩展概念）
│   │   │   └── 组织1/
│   │   │       └── ...
│   │   ├── Institutions/                 # 机构文件夹（扩展概念）
│   │   │   └── 机构1/
│   │   │       └── ...
│   │   ├── Technologies/                 # 技术文件夹（扩展概念）
│   │   │   └── 技术1/
│   │   │       └── ...
│   │   ├── Cultures/                     # 文化文件夹（扩展概念）
│   │   │   └── 文化1/
│   │   │       └── ...
│   │   ├── Languages/                    # 语言文件夹（扩展概念）
│   │   │   └── 语言1/
│   │   │       └── ...
│   │   ├── Religions/                    # 宗教文件夹（扩展概念）
│   │   │   └── 宗教1/
│   │   │       └── ...
│   │   └── Custom/                       # 自定义概念文件夹（用户可添加）
│   │       └── 自定义概念1/
│   │           └── ...
│   ├── Events/                           # 事件文件夹
│   │   ├── 事件1/                       # 每个事件独立文件夹
│   │   │   ├── info.xml                 # 事件基本信息
│   │   │   ├── images/                  # 事件相关图片
│   │   │   ├── characters.xml           # 参与角色
│   │   │   ├── impact.xml               # 事件影响分析
│   │   │   ├── consequences.xml         # 事件后果
│   │   │   ├── prerequisites.xml        # 事件前置条件
│   │   │   └── aftermath.xml            # 事件后续发展
│   │   └── 事件2/
│   │       └── ...
│   ├── Chapters/                         # 章节文件夹
│   │   ├── Chapter01/                   # 每章独立文件夹
│   │   │   ├── content.txt              # 章节内容
│   │   │   ├── outline.xml              # 章节大纲
│   │   │   ├── notes.xml                # 章节笔记
│   │   │   ├── characters.xml           # 章节角色
│   │   │   ├── locations.xml            # 章节地点
│   │   │   ├── events.xml               # 章节事件
│   │   │   ├── themes.xml               # 章节主题
│   │   │   └── analysis.xml             # 章节分析
│   │   └── Chapter02/
│   │       └── ...
│   ├── .kb/                              # 本小说私有知识库与索引
│   │   ├── chroma_vectors/               # 向量索引（如Chroma）
│   │   └── lucene_index/                 # 全文索引（如Lucene.NET）
│   ├── Templates/                        # 模板文件夹
│   │   ├── chapter_template.txt         # 章节模板
│   │   ├── character_template.xml       # 角色模板
│   │   ├── event_template.xml           # 事件模板
│   │   └── location_template.xml        # 地点模板
│   └── Logs/                             # 日志文件夹
│       ├── creation.log                  # 创作日志
│       ├── analysis.log                 # 分析日志
│       ├── error.log                    # 错误日志
│       └── user_actions.log             # 用户操作日志
├── 小说工程2/
│   └── ...
└── （已取消全局知识库与索引，索引随每部小说存放于其 .kb/ 目录内）
```

## 概念文件夹设计说明

### 1. 概念文件夹概述

`Concepts/` 文件夹是小说工程的核心概念管理区域，统一管理所有与小说世界相关的概念实体。这种设计具有以下优势：

- **逻辑清晰**: 所有概念实体集中管理，便于理解和维护
- **扩展性强**: 用户可以轻松添加新的概念类型
- **关系明确**: 概念之间的关系更容易建立和管理
- **分类合理**: 按照概念性质进行分类，符合认知习惯

### 2. 核心概念实体

#### 2.1 Characters/ - 角色
- **作用**: 管理故事中的所有角色
- **包含**: 角色基本信息、头像、关系网络、发展轨迹等
- **特点**: 支持角色间的复杂关系管理

#### 2.2 Factions/ - 势力
- **作用**: 管理各种组织、团体、国家等
- **包含**: 势力信息、成员、层级结构、政策等
- **特点**: 支持势力间的政治关系管理

#### 2.3 Locations/ - 地点
- **作用**: 管理故事发生的各种地点
- **包含**: 地点信息、图片、历史、连接关系等
- **特点**: 支持地点间的空间关系管理

#### 2.4 Items/ - 物品
- **作用**: 管理故事中的重要物品、道具等
- **包含**: 物品信息、图片、属性、历史等
- **特点**: 支持物品的拥有者关系管理

#### 2.5 Themes/ - 主题
- **作用**: 管理故事的主题、价值观等
- **包含**: 主题描述、示例、发展、关联等
- **特点**: 支持主题间的逻辑关系管理

### 3. 扩展概念实体

#### 3.1 Organizations/ - 组织
- **作用**: 管理公司、机构等（与势力区分）
- **特点**: 更注重商业或功能性组织

#### 3.2 Institutions/ - 机构
- **作用**: 管理学校、医院、政府等机构
- **特点**: 更注重公共服务性机构

#### 3.3 Technologies/ - 技术
- **作用**: 管理科技、魔法体系等
- **特点**: 支持技术发展脉络管理

#### 3.4 Cultures/ - 文化
- **作用**: 管理文化背景、传统等
- **特点**: 支持文化传承关系管理

#### 3.5 Languages/ - 语言
- **作用**: 管理虚构语言、方言等
- **特点**: 支持语言演变关系管理

#### 3.6 Religions/ - 宗教
- **作用**: 管理信仰体系、教派等
- **特点**: 支持宗教关系管理

### 4. 自定义概念支持

#### 4.1 Custom/ - 自定义概念
- **作用**: 用户可以根据需要添加新的概念类型
- **特点**: 完全开放，支持任意概念类型
- **示例**: 魔法体系、超能力、种族、职业等

### 5. 概念关系管理

所有概念实体都支持以下关系类型：
- **一对一关系**: 两个概念间的直接关系
- **一对多关系**: 一个概念与多个概念的关系
- **多对多关系**: 多个概念间的复杂关系
- **层次关系**: 概念间的层级关系
- **时间关系**: 概念间的时间先后关系

## 新增文件详细说明

### 1. ProjectSettings.xml - 项目设置文件

```xml
<?xml version="1.0" encoding="UTF-8"?>
<ProjectSettings>
    <BasicInfo>
        <Title>小说标题</Title>
        <Author>作者名称</Author>
        <Genre>小说类型</Genre>
        <Status>创作状态</Status>
        <CreatedDate>2024-01-01</CreatedDate>
        <LastModified>2024-01-01</LastModified>
        <Version>1.0.0</Version>
    </BasicInfo>
    <WritingSettings>
        <TargetWordCount>100000</TargetWordCount>
        <ChapterCount>20</ChapterCount>
        <WordsPerChapter>5000</WordsPerChapter>
        <WritingStyle>王道热血</WritingStyle>
        <NarrativePerspective>第三人称</NarrativePerspective>
        <Tone>积极向上</Tone>
    </WritingSettings>
    <AISettings>
        <ModelName>llama3.1</ModelName>
        <Temperature>0.7</Temperature>
        <MaxTokens>2000</MaxTokens>
        <EnableRealTimeCorrection>true</EnableRealTimeCorrection>
        <EnableStyleConsistency>true</EnableStyleConsistency>
    </AISettings>
    <ExportSettings>
        <DefaultFormat>PDF</DefaultFormat>
        <IncludeImages>true</IncludeImages>
        <IncludeMetadata>true</IncludeMetadata>
        <AutoBackup>true</AutoBackup>
    </ExportSettings>
</ProjectSettings>
```

### 2. writing_guidelines.xml - 写作指导规则

```xml
<?xml version="1.0" encoding="UTF-8"?>
<WritingGuidelines>
    <StyleRules>
        <Rule type="vocabulary">
            <Description>词汇选择规则</Description>
            <Examples>
                <Example>使用积极正面的词汇</Example>
                <Example>避免过于复杂的术语</Example>
            </Examples>
        </Rule>
        <Rule type="sentence_structure">
            <Description>句式结构规则</Description>
            <Examples>
                <Example>短句与长句交替使用</Example>
                <Example>避免过长的复合句</Example>
            </Examples>
        </Rule>
    </StyleRules>
    <CharacterRules>
        <Rule type="dialogue">
            <Description>对话规则</Description>
            <Examples>
                <Example>每个角色有独特的说话方式</Example>
                <Example>对话要符合角色性格</Example>
            </Examples>
        </Rule>
    </CharacterRules>
    <PlotRules>
        <Rule type="pacing">
            <Description>节奏控制规则</Description>
            <Examples>
                <Example>紧张情节后要有缓和</Example>
                <Example>重要转折点要提前铺垫</Example>
            </Examples>
        </Rule>
    </PlotRules>
</WritingGuidelines>
```

### 3. analysis_results.xml - AI分析结果

```xml
<?xml version="1.0" encoding="UTF-8"?>
<AnalysisResults>
    <StyleAnalysis>
        <VocabularyComplexity>中等</VocabularyComplexity>
        <SentenceLength>适中</SentenceLength>
        <EmotionalTone>积极</EmotionalTone>
        <NarrativeStyle>第三人称全知</NarrativeStyle>
    </StyleAnalysis>
    <StructureAnalysis>
        <ChapterBalance>良好</ChapterBalance>
        <PlotPacing>适中</PlotPacing>
        <CharacterDevelopment>充分</CharacterDevelopment>
        <ConflictResolution>合理</ConflictResolution>
    </StructureAnalysis>
    <QualityMetrics>
        <ReadabilityScore>85</ReadabilityScore>
        <ConsistencyScore>90</ConsistencyScore>
        <EngagementScore>88</EngagementScore>
        <OverallScore>87</OverallScore>
    </QualityMetrics>
    <Recommendations>
        <Recommendation priority="high">
            <Title>增加环境描写</Title>
            <Description>建议在对话场景中增加更多环境描写</Description>
        </Recommendation>
        <Recommendation priority="medium">
            <Title>优化角色对话</Title>
            <Description>部分角色的对话可以更加个性化</Description>
        </Recommendation>
    </Recommendations>
</AnalysisResults>
```

### 4. creation_log.xml - 创作日志

```xml
<?xml version="1.0" encoding="UTF-8"?>
<CreationLog>
    <Session id="1">
        <Date>2024-01-01</Date>
        <Time>14:30:00</Time>
        <Duration>120</Duration>
        <WordCount>1500</WordCount>
        <Chapter>第一章</Chapter>
        <Actions>
            <Action type="write">创作了开篇场景</Action>
            <Action type="edit">修改了主角对话</Action>
            <Action type="ai_assist">AI生成了环境描写</Action>
        </Actions>
        <AIFeedback>
            <Suggestion>建议增加更多细节描写</Suggestion>
            <Correction>修正了时间线不一致的问题</Correction>
        </AIFeedback>
    </Session>
    <Session id="2">
        <Date>2024-01-02</Date>
        <Time>09:15:00</Time>
        <Duration>90</Duration>
        <WordCount>1200</WordCount>
        <Chapter>第一章</Chapter>
        <Actions>
            <Action type="write">完成了第一章</Action>
            <Action type="review">回顾了整体结构</Action>
        </Actions>
    </Session>
</CreationLog>
```

### 5. 角色关系网络文件 (relationships.xml)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<Relationships>
    <Character id="char1" name="主角">
        <Relationship target="char2" type="friend" strength="strong">
            <Description>从小一起长大的好友</Description>
            <History>共同经历了多次冒险</History>
        </Relationship>
        <Relationship target="char3" type="rival" strength="medium">
            <Description>竞争对手关系</Description>
            <History>在比赛中多次交锋</History>
        </Relationship>
    </Character>
    <Character id="char2" name="好友">
        <Relationship target="char1" type="friend" strength="strong">
            <Description>主角的忠实伙伴</Description>
        </Relationship>
    </Character>
</Relationships>
```

### 6. 地点连接关系文件 (connections.xml)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<LocationConnections>
    <Location id="loc1" name="主角的家">
        <Connection target="loc2" type="adjacent" distance="500m">
            <Description>步行5分钟到达学校</Description>
            <Route>沿着主街直行</Route>
        </Connection>
        <Connection target="loc3" type="transport" distance="2km">
            <Description>乘坐公交车15分钟到达市中心</Description>
            <Route>乘坐3路公交车</Route>
        </Connection>
    </Location>
    <Location id="loc2" name="学校">
        <Connection target="loc1" type="adjacent" distance="500m">
            <Description>步行5分钟到达主角的家</Description>
        </Connection>
    </Location>
</LocationConnections>
```

## 文件格式规范

### 1. 文本文件格式
- **编码**: UTF-8
- **换行符**: 根据操作系统自动处理
- **缩进**: 使用4个空格或Tab

### 2. XML文件格式
- **编码**: UTF-8
- **缩进**: 使用2个空格
- **属性**: 使用双引号
- **命名**: 使用驼峰命名法

### 3. JSON文件格式
- **编码**: UTF-8
- **缩进**: 使用2个空格
- **属性**: 使用双引号
- **命名**: 使用驼峰命名法

### 4. 图片文件格式
- **支持格式**: JPG, PNG, GIF, BMP, TIFF
- **推荐格式**: JPG (照片), PNG (透明背景)
- **最大尺寸**: 4096x4096像素
- **文件大小**: 建议不超过10MB

### 5. 音频文件格式
- **支持格式**: MP3, WAV, OGG, M4A
- **推荐格式**: MP3 (通用), WAV (无损)
- **采样率**: 44.1kHz
- **比特率**: 128kbps以上

### 6. 视频文件格式
- **支持格式**: MP4, AVI, MOV, WMV
- **推荐格式**: MP4 (通用)
- **分辨率**: 1080p以下
- **文件大小**: 建议不超过100MB

## 文件命名规范 

### 1. 基本规则
- 使用UTF-8编码的字符
- 避免使用特殊字符: `<>:"/\|?*`
- 文件名不区分大小写
- 使用下划线或连字符分隔单词

### 2. 命名模式
- **角色文件**: `角色名_类型.xml` (如: `张三_主角.xml`)
- **事件文件**: `事件名_日期.xml` (如: `初次相遇_20240101.xml`)
- **章节文件**: `Chapter_序号` (如: `Chapter_01`)
- **图片文件**: `描述_序号.扩展名` (如: `角色头像_01.jpg`)

### 3. 文件夹命名
- 使用中文或英文
- 避免使用空格
- 使用下划线分隔单词
- 保持简洁明了

## 版本控制支持

### 1. Git集成
- 支持Git版本控制
- 自动生成.gitignore文件
- 支持分支管理
- 支持合并冲突解决

### 2. 备份策略
- 自动备份到Backups文件夹
- 按日期创建备份
- 支持增量备份
- 支持手动备份

### 3. 协作支持
- 支持多用户编辑
- 支持文件锁定
- 支持变更通知
- 支持冲突解决

## 扩展性设计

### 1. 插件支持
- 支持自定义文件类型
- 支持自定义处理逻辑
- 支持第三方工具集成
- 支持API扩展

### 2. 模板系统
- 支持自定义模板
- 支持模板继承
- 支持动态模板
- 支持模板验证

### 3. 导入导出
- 支持多种格式导入
- 支持多种格式导出
- 支持批量处理
- 支持格式转换

## 总结

这个文件结构设计为AINovelAgent项目提供了完整的小说工程管理方案。通过纯文件系统的方式，实现了：

1. **完全独立**: 不依赖任何数据库或外部服务
2. **高度可读**: 所有文件都可以直接编辑和阅读
3. **多媒体支持**: 天然支持各种媒体文件
4. **版本控制**: 完全支持Git等版本控制工具
5. **协作友好**: 支持多用户共享和编辑
6. **扩展性强**: 可以轻松添加新的文件类型和功能
7. **跨平台**: 在所有操作系统上都能正常工作
8. **概念统一**: 通过Concepts文件夹统一管理所有概念实体，逻辑清晰，便于扩展

### 概念文件夹设计优势

- **逻辑清晰**: 所有概念实体集中管理，便于理解和维护
- **扩展性强**: 用户可以轻松添加新的概念类型（如魔法体系、超能力、种族等）
- **关系明确**: 概念之间的关系更容易建立和管理
- **分类合理**: 按照概念性质进行分类，符合认知习惯
- **完全开放**: 支持任意自定义概念类型，满足不同创作需求

这种设计确保了项目的可移植性、可维护性和可扩展性，为用户提供了灵活而强大的小说创作环境。概念文件夹的设计特别适合复杂的世界观构建和长期的小说系列创作。
