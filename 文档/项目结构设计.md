# AI小说写作助手项目结构设计

## 🏗️ 项目架构概述

本项目采用分层架构设计，遵循MVVM模式，确保代码结构清晰、易于维护和扩展。

## 📁 项目文件夹结构

```
AINovelAgent/
├── Models/                    # 数据模型层
│   ├── Base/                 # 基础模型类
│   │   ├── BaseModel.cs      # 基础模型抽象类
│   │   └── BaseEntity.cs     # 基础实体类
│   ├── Novel/                # 小说相关模型
│   │   ├── Novel.cs          # 小说模型
│   │   ├── Chapter.cs        # 章节模型
│   │   ├── Character.cs      # 角色模型
│   │   ├── Event.cs          # 事件模型
│   │   ├── Faction.cs        # 势力模型
│   │   └── Timeline.cs       # 时间线模型
│   ├── AI/                   # AI相关模型
│   │   ├── AIModel.cs        # AI模型信息
│   │   ├── Conversation.cs   # 对话记录
│   │   └── AnalysisResult.cs # 分析结果
│   └── Writing/              # 写作相关模型
│       ├── WritingGuideline.cs # 写作规范
│       ├── GenreTemplate.cs   # 类型模板
│       └── WorldSetting.cs    # 世界观设定
├── Services/                  # 业务服务层
│   ├── Interfaces/           # 服务接口
│   │   ├── IService.cs       # 服务基接口
│   │   ├── IFileService.cs   # 文件服务接口
│   │   ├── IAIService.cs     # AI服务接口
│   │   └── ILoggingService.cs # 日志服务接口
│   ├── File/                 # 文件服务
│   │   ├── FileService.cs    # 文件操作服务
│   │   ├── ImportService.cs  # 文件导入服务
│   │   └── ExportService.cs  # 文件导出服务
│   ├── Configuration/        # 配置服务
│   │   ├── ConfigurationService.cs # 配置管理服务
│   │   └── SettingsManager.cs # 设置管理器
│   ├── AI/                   # AI服务
│   │   ├── AIService.cs      # AI核心服务
│   │   ├── OllamaService.cs  # Ollama集成服务
│   │   └── AnalysisService.cs # 分析服务
│   ├── Writing/              # 写作服务
│   │   ├── WritingGuidanceService.cs # 写作指导服务
│   │   ├── OutlineService.cs # 大纲生成服务
│   │   └── WorldBuildingService.cs # 世界观构建服务
│   └── Management/           # 管理服务
│       ├── NovelManagementService.cs # 小说管理服务
│       ├── CharacterManagementService.cs # 角色管理服务
│       └── TimelineManagementService.cs # 时间线管理服务
├── ViewModels/               # 视图模型层
│   ├── Base/                 # 基础视图模型
│   │   ├── BaseViewModel.cs  # 基础视图模型类
│   │   ├── RelayCommand.cs   # 命令实现
│   │   └── ObservableObject.cs # 可观察对象基类
│   ├── Main/                 # 主窗口视图模型
│   │   ├── MainWindowViewModel.cs # 主窗口视图模型
│   │   └── NavigationViewModel.cs # 导航视图模型
│   ├── Novel/                # 小说相关视图模型
│   │   ├── NovelListViewModel.cs # 小说列表视图模型
│   │   ├── NovelEditorViewModel.cs # 小说编辑器视图模型
│   │   └── CharacterEditorViewModel.cs # 角色编辑器视图模型
│   ├── AI/                   # AI相关视图模型
│   │   ├── AIChatViewModel.cs # AI对话视图模型
│   │   ├── AnalysisViewModel.cs # 分析视图模型
│   │   └── WritingGuidanceViewModel.cs # 写作指导视图模型
│   └── Settings/             # 设置相关视图模型
│       ├── SettingsViewModel.cs # 设置视图模型
│       └── AIConfigViewModel.cs # AI配置视图模型
├── Views/                    # 视图层
│   ├── Base/                 # 基础视图
│   │   ├── BaseWindow.xaml   # 基础窗口
│   │   ├── BaseUserControl.xaml # 基础用户控件
│   │   ├── BaseStyles.xaml   # 基础样式
│   │   └── Converters/       # 值转换器
│   ├── Main/                 # 主窗口视图
│   │   ├── MainWindow.xaml   # 主窗口
│   │   ├── NavigationView.xaml # 导航视图
│   │   └── StatusBarControl.xaml # 状态栏控件
│   ├── Novel/                # 小说相关视图
│   │   ├── NovelListView.xaml # 小说列表视图
│   │   ├── NovelEditorView.xaml # 小说编辑器视图
│   │   ├── CharacterEditorView.xaml # 角色编辑器视图
│   │   └── TimelineView.xaml # 时间线视图
│   ├── AI/                   # AI相关视图
│   │   ├── AIChatView.xaml   # AI对话视图
│   │   ├── AnalysisView.xaml # 分析视图
│   │   └── WritingGuidanceView.xaml # 写作指导视图
│   └── Settings/             # 设置相关视图
│       ├── SettingsView.xaml # 设置视图
│       └── AIConfigView.xaml # AI配置视图
├── Utils/                    # 工具类
│   ├── Extensions/           # 扩展方法
│   │   ├── StringExtensions.cs # 字符串扩展
│   │   ├── CollectionExtensions.cs # 集合扩展
│   │   └── FileExtensions.cs # 文件扩展
│   ├── Helpers/              # 辅助类
│   │   ├── FileHelper.cs     # 文件辅助类
│   │   ├── ValidationHelper.cs # 验证辅助类
│   │   └── SecurityHelper.cs # 安全辅助类
│   ├── Constants/            # 常量定义
│   │   ├── AppConstants.cs   # 应用程序常量
│   │   ├── FileConstants.cs  # 文件相关常量
│   │   └── UIConstants.cs    # UI相关常量
│   └── Enums/                # 枚举定义
│       ├── FileType.cs       # 文件类型枚举
│       ├── NovelGenre.cs     # 小说类型枚举
│       └── AnalysisType.cs   # 分析类型枚举
├── Resources/                # 资源文件
│   ├── Images/               # 图片资源
│   ├── Icons/                # 图标资源
│   ├── Styles/               # 样式资源
│   └── Themes/               # 主题资源
├── Data/                     # 数据文件
│   ├── Templates/            # 模板文件
│   ├── Examples/             # 示例文件
│   └── Config/               # 配置文件
├── Tests/                    # 测试项目
│   ├── UnitTests/            # 单元测试
│   ├── IntegrationTests/     # 集成测试
│   └── UITests/              # UI测试
├── Docs/                     # 文档
│   ├── API/                  # API文档
│   ├── UserGuide/            # 用户指南
│   └── DeveloperGuide/       # 开发者指南
├── App.xaml                  # 应用程序入口
├── App.xaml.cs               # 应用程序代码后台
├── MainWindow.xaml           # 主窗口
├── MainWindow.xaml.cs        # 主窗口代码后台
├── appsettings.json          # 应用程序配置
├── appsettings.Development.json # 开发环境配置
└── AINovelAgent.csproj       # 项目文件
```

## 🔧 命名空间组织

### 主要命名空间结构
```csharp
namespace AINovelAgent
{
    // 数据模型层
    namespace Models
    {
        namespace Base          // 基础模型
        namespace Novel         // 小说相关模型
        namespace AI            // AI相关模型
        namespace Writing       // 写作相关模型
    }
    
    // 业务服务层
    namespace Services
    {
        namespace Interfaces    // 服务接口
        namespace File          // 文件服务
        namespace Configuration // 配置服务
        namespace AI            // AI服务
        namespace Writing       // 写作服务
        namespace Management    // 管理服务
    }
    
    // 视图模型层
    namespace ViewModels
    {
        namespace Base          // 基础视图模型
        namespace Main          // 主窗口视图模型
        namespace Novel         // 小说相关视图模型
        namespace AI            // AI相关视图模型
        namespace Settings      // 设置相关视图模型
    }
    
    // 视图层
    namespace Views
    {
        namespace Base          // 基础视图
        namespace Main          // 主窗口视图
        namespace Novel         // 小说相关视图
        namespace AI            // AI相关视图
        namespace Settings      // 设置相关视图
    }
    
    // 工具类
    namespace Utils
    {
        namespace Extensions    // 扩展方法
        namespace Helpers       // 辅助类
        namespace Constants     // 常量定义
        namespace Enums         // 枚举定义
    }
}
```

## 🎯 架构设计原则

### 1. 分层架构
- **数据模型层 (Models)**: 定义数据结构和业务实体
- **业务服务层 (Services)**: 实现业务逻辑和数据处理
- **视图模型层 (ViewModels)**: 连接视图和业务逻辑
- **视图层 (Views)**: 用户界面展示

### 2. 依赖关系
- 上层依赖下层，下层不依赖上层
- 通过接口实现依赖倒置
- 使用依赖注入管理服务实例

### 3. 模块化设计
- 每个功能模块相对独立
- 模块间通过接口通信
- 支持插件式扩展

### 4. 可扩展性
- 预留扩展接口
- 支持新功能模块添加
- 配置驱动的功能开关

## 📋 文件命名规范

### 1. 类文件命名
- **模型类**: 使用名词，如 `Novel.cs`, `Character.cs`
- **服务类**: 使用名词+Service，如 `FileService.cs`, `AIService.cs`
- **视图模型类**: 使用名词+ViewModel，如 `MainWindowViewModel.cs`
- **视图类**: 使用名词+View，如 `NovelEditorView.xaml`

### 2. 接口命名
- 以 `I` 开头，如 `IService.cs`, `IFileService.cs`

### 3. 枚举命名
- 使用名词，如 `FileType.cs`, `NovelGenre.cs`

### 4. 扩展方法命名
- 使用动词+名词，如 `StringExtensions.cs`

## 🔄 数据流设计

### 1. 用户操作流程
```
用户操作 → 视图层 → 视图模型层 → 业务服务层 → 数据模型层
```

### 2. 数据更新流程
```
数据变化 → 数据模型层 → 业务服务层 → 视图模型层 → 视图层 → 界面更新
```

### 3. 服务调用流程
```
视图模型 → 服务接口 → 服务实现 → 数据访问 → 返回结果
```

## 🚀 扩展点设计

### 1. 插件系统
- 支持自定义AI模型集成
- 支持自定义文件格式处理
- 支持自定义分析算法

### 2. 主题系统
- 支持多种UI主题
- 支持自定义样式
- 支持高对比度模式

### 3. 国际化支持
- 多语言界面
- 本地化配置
- 文化特定功能

## 📊 性能考虑

### 1. 内存管理
- 及时释放不需要的资源
- 使用对象池管理频繁创建的对象
- 实现弱引用避免内存泄漏

### 2. 异步处理
- 长时间操作使用异步模式
- 避免阻塞UI线程
- 实现取消和进度报告

### 3. 缓存策略
- 缓存频繁访问的数据
- 实现智能缓存失效
- 支持多级缓存

## 🔒 安全考虑

### 1. 数据保护
- 敏感信息加密存储
- 用户权限控制
- 操作日志记录

### 2. 输入验证
- 文件类型验证
- 内容安全检查
- 防止恶意代码注入

### 3. 网络安全
- 本地服务安全
- API调用安全
- 数据传输加密

## 📝 开发规范

### 1. 代码组织
- 每个文件只包含一个主要类
- 相关功能放在同一命名空间
- 保持文件大小合理

### 2. 注释规范
- 公共接口必须有XML文档注释
- 复杂逻辑需要详细注释
- 使用中文注释提高可读性

### 3. 错误处理
- 所有公共方法都要有异常处理
- 提供有意义的错误信息
- 实现错误恢复机制

---

**文档版本**: 1.0  
**最后更新**: 2024年8月31日  
**维护人员**: 开发团队
