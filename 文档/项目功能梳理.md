# AI小说写作助手项目功能梳理

## 项目概述
**项目名称**: AINovelAgent (AI小说代理)  
**目标**: 创建一个智能的小说写作辅助工具，具备深度学习和分析能力

## 技术架构概述

本项目采用现代化的.NET技术栈，结合AI服务和本地文件系统，构建智能小说写作助手。详细的技术选型和实现方案请参考 `技术栈与实现方案.md` 文档。

### 核心技术特点
- **模块化设计**: 服务层、文件层、界面层清晰分离
- **可扩展性**: 支持插件式功能扩展
- **完全本地化**: 所有功能本地运行，无需网络连接
- **AI集成**: 深度集成本地部署的LLM模型，提供智能创作辅助
- **文件驱动**: 完全基于文件系统，无需数据库

## 核心功能模块

### 1. 本地知识库构建与管理

#### 1.1 知识库存储架构
- **文件系统设计**: 使用本地文件系统存储小说内容和分析结果
- **数据模型**: 
  - 小说信息（标题、作者、类型、内容、导入时间等）
  - 写作规范（风格、结构、情感等分类的创作指导）
  - 分析结果（写作风格、情感分析、结构分析等）
- **文件组织**: 按小说分类建立文件夹结构，每个小说独立管理

#### 1.2 内容导入功能
- **支持格式**: TXT、DOCX、PDF等常见文档格式
- **批量导入**: 支持多文件同时导入
- **元数据提取**: 自动识别标题、作者等信息
- **内容预处理**: 文本清理、编码转换等

#### 1.3 知识库管理接口
- **CRUD操作**: 增删改查小说和写作规范
- **搜索功能**: 基于关键词、作者、类型等条件搜索
- **分类管理**: 按类型、风格、情感等维度分类
- **版本控制**: 记录内容修改历史

### 2. 智能内容分析与规范提取

#### 2.1 写作风格分析
- **语言特征识别**: 词汇选择、句式结构、修辞手法
- **叙事风格**: 第一人称/第三人称、叙述节奏、视角转换
- **表达习惯**: 常用词汇、句式模式、语言特色

#### 2.2 结构层次分析
- **整体架构**: 章节组织、情节发展脉络
- **段落结构**: 段落长度、逻辑关系、过渡方式
- **内容层次**: 主要情节、支线故事、细节描写

#### 2.3 情感与氛围分析
- **情感识别**: 识别文本中的情感色彩和情绪变化
- **氛围营造**: 环境描写、心理描写、情感渲染
- **读者体验**: 分析作者想要传达的情感效果

#### 2.4 写作技巧提取
- **情节设计**: 冲突设置、悬念制造、高潮安排
- **人物塑造**: 性格特征、行为模式、对话风格
- **环境描写**: 场景设置、氛围营造、细节刻画

### 3. 智能创作指导系统

#### 3.1 规范应用
- **风格一致性**: 确保生成内容符合既定写作风格
- **结构指导**: 提供情节发展和章节组织建议
- **情感引导**: 指导如何营造特定的情感氛围

#### 3.2 创作建议
- **情节发展**: 基于已有内容的情节续写建议
- **人物对话**: 符合角色性格的对话生成
- **环境描写**: 场景和氛围的描写建议

#### 3.3 质量提升
- **内容优化**: 提供改进建议和替代表达
- **逻辑检查**: 检查情节逻辑和人物行为一致性
- **风格调整**: 根据目标风格调整表达方式

### 4. 智能创作流程系统

#### 4.1 类型风格指导生成
- **类型识别**: 识别小说类型（王道热血、公路片、单元剧等）
- **风格分析**: 分析该类型小说的典型写作方法和风格特征
- **规范提取**: 从知识库中提取相关类型的成功案例和写作技巧
- **指导生成**: 生成针对性的创作指导规则，并加入当前小说指导体系
- **动态更新**: 根据创作进展实时更新和优化指导规则

#### 4.2 世界观构建系统
- **已有作品分析**: 分析现有作品的世界观设定，提取核心要素
- **角色二创支持**: 读取已有角色信息，支持二次创作和世界观扩展
- **多作品融合**: 支持多部作品世界观融合，生成穿越/综漫类世界观
- **原创世界观**: 根据用户需求生成全新的原创世界观设定
- **指导规则整合**: 将世界观设定转化为创作指导规则，指导后续创作

#### 4.3 智能大纲生成系统
- **字数规划**: 根据用户提供的总字数要求进行创作规划
- **章节拆分**: 智能计算章节数量和每章字数分配
- **结构梳理**: 分析情节发展脉络，优化章节结构安排
- **大纲生成**: 生成详细的分章节创作大纲
- **指导规则**: 将大纲结构转化为创作指导规则，确保结构完整性

### 5. 智能内容创作系统

#### 5.1 内容分析与创作指导
- **上下文理解**: 分析用户输入内容与整体故事的关联性
- **作用评估**: 判断当前内容在情节发展中的作用和重要程度
- **字数规划**: 根据内容重要性智能选择合适字数（几百到几千字）
- **创作指导**: 提供具体的创作建议：
  - **情感重点**: 明确需要突出的情感色彩和氛围
  - **内容重点**: 指出需要着重描写的核心内容
  - **创作手法**: 推荐合适的描写方式（侧面描写、心理描写、场景描写等）

#### 5.2 分段创作与内容生成
- **内容拆分**: 将创作任务分解为多个小段落
- **分段思考**: 为每个小段提供独立的创作思路和内容规划
- **内容生成**: 基于上下文和创作指导生成具体内容
- **质量检查**: 确保生成内容符合风格一致性和逻辑连贯性

#### 5.3 结构更新与完整性检查
- **上下文更新**: 创作完成后更新整体结构上下文
- **完整性评估**: 检查当前内容段是否完整（如一场战斗是否完成）
- **梗概压缩**: 对完整段落进行梗概性质的内容压缩
- **结构整合**: 将压缩后的梗概加入结构上下文中，为后续创作提供参考

#### 5.4 实时纠错与质量保障
- **创作过程监控**: 在创作过程中实时监控逻辑一致性
- **即时纠错提示**: 发现问题时立即在创作界面上显示纠错建议
- **智能建议集成**: 纠错建议直接集成在创作流程中，不打断创作思路
- **用户选择机制**: 用户可选择接受、忽略或修改纠错建议
- **学习反馈**: 根据用户选择优化纠错算法和检测规则

### 6. 小说结构管理系统

#### 6.1 时间线管理系统
- **故事时间线生成**: 自动生成故事的整体时间线，包含主要事件节点
- **时间节点管理**: 记录每个重要事件的发生时间和持续时间
- **时间线可视化**: 提供时间线的图形化展示，便于理解故事发展脉络
- **时间冲突检测**: 自动检测时间线中的逻辑冲突和不一致之处
- **分支时间线**: 支持多线并行的复杂时间线结构

#### 6.2 事件卡管理系统
- **事件记录**: 详细记录每个事件的基本信息、发生地点、参与人员
- **人物关联**: 记录事件中涉及的所有人物及其在事件中的角色
- **事件结果**: 记录事件的直接结果和间接影响
- **故事影响**: 分析事件对整体故事发展的影响和推动作用
- **事件分类**: 按重要性、类型、影响范围等维度对事件进行分类管理

#### 6.3 势力卡管理系统
- **势力信息**: 记录势力的基本信息、组织结构、核心成员
- **人物关联**: 管理势力中所有成员的身份和地位
- **势力时间线**: 记录势力的发展历程和重要节点
- **事件态度**: 记录势力对各个重要事件的态度和反应
- **势力关系**: 管理不同势力之间的合作关系、竞争关系等
- **势力发展**: 追踪势力的兴衰变化和影响力变化

#### 6.4 角色卡管理系统
- **基础信息**: 记录角色的基本信息、外貌特征、背景故事
- **性格特征**: 详细描述角色的性格特点、行为模式、价值观
- **关系网络**: 记录角色与其他角色、势力的关系网络
- **事件经历**: 追踪角色参与的所有事件及其在事件中的表现
- **成长轨迹**: 记录角色经历事件后的态度、性格转变过程
- **实时状态**: 在创作过程中实时更新角色的情感状态、态度变化
- **角色弧线**: 分析角色的成长弧线和性格发展轨迹

### 7. 智能纠错与质量保障系统

#### 7.1 创作过程实时纠错
- **集成式检测**: 纠错机制完全集成在创作模块中，作为创作思考过程的一部分
- **实时监控**: 在创作过程中实时检测逻辑错误、情感冲突、空间矛盾等
- **即时反馈**: 发现问题时立即提供纠错建议，不影响创作流程
- **智能提示**: 在创作界面上智能显示潜在问题和改进建议

#### 7.2 多维度实时检测
- **情感逻辑**: 实时检测角色情感变化的合理性和连续性
- **空间逻辑**: 实时检查角色位置一致性和移动合理性
- **时间逻辑**: 实时验证时间线一致性和因果关系
- **角色行为**: 实时检查行为与性格设定的一致性
- **情节逻辑**: 实时验证事件因果关系的合理性

#### 7.3 智能纠错策略
- **优先级排序**: 根据错误严重程度和影响范围进行优先级排序
- **纠错建议生成**: 为每个检测到的错误提供具体的纠错建议
- **用户确认机制**: 在应用纠错建议前征求用户确认
- **学习优化**: 根据用户反馈优化纠错算法和检测规则
- **用户优先级**: 当用户明确要求特殊表达时，以用户输入为准

### 8. 创作界面与交互系统

#### 8.1 双栏创作界面
- **小说内容栏**: 展示成品小说内容，支持用户直接编辑和修改
- **AI对话栏**: 显示与AI的创作对话，包含创作指导、建议和修改请求
- **实时同步**: 两个栏位内容实时同步，确保创作过程的一致性
- **分屏布局**: 支持左右分屏、上下分屏等多种布局方式

#### 8.2 AI创作交互
- **创作请求**: 用户可以向AI请求创作新内容或修改现有内容
- **操作控制**: 支持Keep（保留）、Undo（撤销）、Modify（修改）等操作
- **版本管理**: 记录AI生成内容的版本历史，支持版本回滚
- **用户确认**: AI生成内容需要用户确认后才能应用到小说中

#### 8.3 内容编辑权限
- **用户完全控制**: 用户对所有内容（小说、背景、大纲、各种卡）都有完全编辑权限
- **AI辅助创作**: AI提供创作建议和内容生成，但最终决定权在用户
- **混合编辑**: 支持用户手动编辑和AI辅助创作的混合模式
- **实时预览**: 编辑过程中实时预览修改效果

### 9. 文件管理与存储系统

#### 9.1 标准化文件格式
- **文本格式**: 小说内容、对话记录等使用标准TXT格式存储
- **XML格式**: 结构化数据（大纲、角色卡、事件卡等）使用XML格式存储
- **可读性**: 所有文件格式都便于用户直接阅读和编辑
- **跨平台兼容**: 文件格式支持在不同系统和程序间交换

#### 9.2 文件系统管理
- **直观的目录结构**: 使用系统自带的文件系统进行管理，结构清晰易懂
- **分类存储**: 按小说、角色、事件、大纲等分类建立文件夹结构
- **版本控制**: 支持文件版本管理，记录修改历史
- **备份机制**: 自动备份重要文件，防止数据丢失

#### 9.3 脱离程序读写
- **独立文件**: 所有内容都可以脱离程序进行读写
- **标准格式**: 使用通用的文本和XML格式，任何文本编辑器都能打开
- **导入导出**: 支持从外部文件导入内容，也可以导出到外部文件
- **协作支持**: 多个用户可以共享和编辑同一套文件

## 技术架构设计

### 1. 文件层
```
Models/
├── Novel.cs                     # 小说数据模型
├── WritingGuideline.cs          # 写作规范模型
├── AnalysisResult.cs            # 分析结果模型
├── GenreTemplate.cs             # 类型风格模板模型
├── WorldSetting.cs              # 世界观设定模型
├── Character.cs                 # 角色模型
├── ChapterOutline.cs            # 章节大纲模型
├── ContentSegment.cs            # 内容段落模型
├── CreationContext.cs           # 创作上下文模型
├── ContentSummary.cs            # 内容梗概模型
├── Timeline.cs                  # 时间线模型
├── Event.cs                     # 事件模型
├── Faction.cs                   # 势力模型
├── CharacterEvent.cs            # 角色事件关联模型
├── FactionEvent.cs              # 势力事件关联模型
├── CharacterState.cs            # 角色状态模型
├── LogicValidation.cs            # 逻辑验证模型（集成在创作上下文中）
├── AIConversation.cs            # AI对话记录模型
├── ContentVersion.cs             # 内容版本管理模型
└── FileStructure.cs              # 文件结构管理模型
```
```

## 技术实现概述

本项目采用现代化的技术架构，结合AI服务和本地文件系统，为用户提供智能创作辅助。详细的技术选型、工具、插件和实现方案请参考 `技术栈与实现方案.md` 文档。

### 核心技术特点
- **AI驱动**: 集成多种AI服务，提供智能分析和创作指导
- **本地优先**: 核心功能支持离线使用，保护用户隐私
- **文件驱动**: 完全基于文件系统，支持多媒体文件管理
- **模块化设计**: 清晰的分层架构，便于维护和扩展

## 技术选型概述

详细的技术选型建议请参考 `技术栈与实现方案.md` 文档中的"技术选型建议"章节。

## AI功能调用接口设计

### 1. 文件操作接口

#### 1.1 文件读取接口
- **读取TXT文件**: `ReadTextFile(string filePath)` - 读取纯文本文件内容
- **读取DOCX文件**: `ReadDocxFile(string filePath)` - 读取Word文档内容
- **读取PDF文件**: `ReadPdfFile(string filePath)` - 读取PDF文档内容
- **读取XML文件**: `ReadXmlFile(string filePath)` - 读取XML结构化数据
- **读取图片文件**: `ReadImageFile(string filePath)` - 读取图片文件（JPG、PNG、GIF等）
- **读取音频文件**: `ReadAudioFile(string filePath)` - 读取音频文件（MP3、WAV等）
- **读取视频文件**: `ReadVideoFile(string filePath)` - 读取视频文件（MP4、AVI等）
- **批量读取文件**: `ReadMultipleFiles(List<string> filePaths)` - 批量读取多个文件

#### 1.2 文件写入接口
- **写入TXT文件**: `WriteTextFile(string filePath, string content)` - 写入纯文本内容
- **写入XML文件**: `WriteXmlFile(string filePath, object data)` - 写入XML结构化数据
- **保存图片文件**: `SaveImageFile(string filePath, Image image, string format)` - 保存图片文件
- **保存音频文件**: `SaveAudioFile(string filePath, AudioData audio, string format)` - 保存音频文件
- **保存视频文件**: `SaveVideoFile(string filePath, VideoData video, string format)` - 保存视频文件
- **导出小说内容**: `ExportNovelContent(string novelPath, string format)` - 导出小说为指定格式
- **保存分析结果**: `SaveAnalysisResult(string filePath, AnalysisResult result)` - 保存分析结果

#### 1.3 文件管理接口
- **创建目录**: `CreateDirectory(string directoryPath)` - 创建文件夹结构
- **创建角色文件夹**: `CreateCharacterFolder(string novelPath, string characterName)` - 创建角色文件夹结构
- **创建势力文件夹**: `CreateFactionFolder(string novelPath, string factionName)` - 创建势力文件夹结构
- **创建事件文件夹**: `CreateEventFolder(string novelPath, string eventName)` - 创建事件文件夹结构
- **删除文件**: `DeleteFile(string filePath)` - 删除指定文件
- **删除文件夹**: `DeleteDirectory(string directoryPath)` - 删除指定文件夹及其内容
- **移动文件**: `MoveFile(string sourcePath, string targetPath)` - 移动文件位置
- **移动文件夹**: `MoveDirectory(string sourcePath, string targetPath)` - 移动文件夹位置
- **复制文件**: `CopyFile(string sourcePath, string targetPath)` - 复制文件
- **复制文件夹**: `CopyDirectory(string sourcePath, string targetPath)` - 复制文件夹及其内容

### 2. 文件系统操作接口

#### 2.1 知识库查询接口
- **查询小说**: `QueryNovels(string keyword, string author, string genre)` - 基于文件系统的多条件查询小说
- **查询写作规范**: `QueryWritingGuidelines(string category, string style)` - 查询写作规范文件
- **查询分析结果**: `QueryAnalysisResults(string novelPath, string analysisType)` - 查询分析结果文件
- **全文搜索**: `FullTextSearch(string query, string scope)` - 基于Lucene.NET的全文内容搜索

#### 2.2 文件更新接口
- **更新小说信息**: `UpdateNovelInfo(string novelPath, NovelInfo info)` - 更新小说信息文件
- **更新写作规范**: `UpdateWritingGuideline(string guidelinePath, WritingGuideline guideline)` - 更新写作规范文件
- **添加分析结果**: `AddAnalysisResult(string novelPath, AnalysisResult result)` - 添加新的分析结果文件
- **更新角色状态**: `UpdateCharacterState(string characterPath, CharacterState state)` - 更新角色状态文件

#### 2.3 文件统计接口
- **统计小说数量**: `CountNovels(string condition)` - 统计符合条件的文件夹数量
- **统计分析结果**: `CountAnalysisResults(string novelPath)` - 统计小说的分析结果文件数量
- **统计用户行为**: `CountUserActions(string actionType, DateTime startTime, DateTime endTime)` - 统计用户操作日志文件

### 3. AI分析接口

#### 3.1 内容分析接口
- **分析写作风格**: `AnalyzeWritingStyle(string content)` - 分析文本的写作风格
- **分析情感色彩**: `AnalyzeEmotionalTone(string content)` - 分析文本的情感色彩
- **分析结构层次**: `AnalyzeStructure(string content)` - 分析文本的结构层次
- **分析写作技巧**: `AnalyzeWritingTechniques(string content)` - 分析文本的写作技巧

#### 3.2 智能生成接口
- **生成写作建议**: `GenerateWritingAdvice(string content, string style)` - 生成写作建议
- **生成续写内容**: `GenerateContinuation(string context, int wordCount)` - 生成续写内容
- **生成角色对话**: `GenerateCharacterDialogue(string character, string situation)` - 生成角色对话
- **生成环境描写**: `GenerateEnvironmentDescription(string scene, string mood)` - 生成环境描写

#### 3.3 质量检查接口
- **检查逻辑一致性**: `CheckLogicConsistency(string content, NovelContext context)` - 检查逻辑一致性
- **检查情感连续性**: `CheckEmotionalContinuity(string content, CharacterState state)` - 检查情感连续性
- **检查空间一致性**: `CheckSpatialConsistency(string content, Timeline timeline)` - 检查空间一致性
- **检查角色行为**: `CheckCharacterBehavior(string content, CharacterProfile profile)` - 检查角色行为

### 4. 创作指导接口

#### 4.1 类型风格指导
- **识别小说类型**: `IdentifyNovelGenre(string content)` - 识别小说类型
- **生成风格指导**: `GenerateStyleGuidance(string genre, string targetStyle)` - 生成风格指导
- **提取成功案例**: `ExtractSuccessCases(string genre, string aspect)` - 提取成功案例

#### 4.2 世界观构建
- **分析世界观**: `AnalyzeWorldView(string content)` - 分析现有世界观
- **生成世界观**: `GenerateWorldView(string requirements, string genre)` - 生成新世界观
- **融合世界观**: `MergeWorldViews(List<string> worldViews)` - 融合多个世界观

#### 4.3 大纲生成
- **生成章节大纲**: `GenerateChapterOutline(string plot, int totalWords, int chapterCount)` - 生成章节大纲
- **规划字数分配**: `PlanWordDistribution(int totalWords, List<string> chapters)` - 规划字数分配
- **优化结构安排**: `OptimizeStructure(List<ChapterOutline> chapters)` - 优化结构安排

### 5. 结构管理接口

#### 5.1 时间线管理
- **生成时间线**: `GenerateTimeline(List<Event> events)` - 生成故事时间线
- **检测时间冲突**: `DetectTimeConflicts(Timeline timeline)` - 检测时间冲突
- **更新时间节点**: `UpdateTimeNode(int eventId, DateTime newTime)` - 更新时间节点

#### 5.2 事件管理
- **记录事件**: `RecordEvent(EventInfo eventInfo)` - 记录新事件
- **更新事件**: `UpdateEvent(int eventId, EventInfo eventInfo)` - 更新事件信息
- **分析事件影响**: `AnalyzeEventImpact(int eventId, List<int> affectedCharacters)` - 分析事件影响

#### 5.3 角色管理
- **创建角色**: `CreateCharacter(CharacterInfo characterInfo)` - 创建新角色
- **更新角色**: `UpdateCharacter(int characterId, CharacterInfo characterInfo)` - 更新角色信息
- **追踪角色发展**: `TrackCharacterDevelopment(int characterId, List<int> eventIds)` - 追踪角色发展

### 6. 用户交互接口

#### 6.1 创作界面
- **获取创作上下文**: `GetCreationContext(string novelPath, string currentChapter)` - 获取创作上下文
- **保存创作内容**: `SaveCreationContent(string novelPath, string chapterPath, string content)` - 保存创作内容
- **获取AI建议**: `GetAIAdvice(string currentContent, string request)` - 获取AI建议

#### 6.2 版本控制
- **创建版本**: `CreateVersion(int contentId, string versionName)` - 创建内容版本
- **回滚版本**: `RollbackToVersion(int contentId, int versionId)` - 回滚到指定版本
- **比较版本**: `CompareVersions(int contentId, int version1Id, int version2Id)` - 比较版本差异

#### 6.3 用户反馈
- **记录用户选择**: `RecordUserChoice(string actionType, string choice, string reason)` - 记录用户选择
- **学习用户偏好**: `LearnUserPreference(int userId, string preferenceType, string value)` - 学习用户偏好
- **优化建议算法**: `OptimizeAdviceAlgorithm(List<UserFeedback> feedbacks)` - 优化建议算法

### 7. 系统管理接口

#### 7.1 模型管理
- **发现可用模型**: `DiscoverAvailableModels()` - 自动发现Ollama中已部署的模型
- **获取模型信息**: `GetModelInfo(string modelName)` - 获取指定模型的详细信息
- **切换对话模型**: `SwitchChatModel(string modelName)` - 切换到指定的对话模型
- **切换嵌入模型**: `SwitchEmbeddingModel(string modelName)` - 切换到指定的嵌入模型
- **测试模型连接**: `TestModelConnection(string modelName)` - 测试指定模型的连接状态

#### 7.2 MCP服务管理
- **发现可用MCP服务**: `DiscoverAvailableMCPServices()` - 自动发现可用的MCP服务
- **获取MCP服务信息**: `GetMCPServiceInfo(string serviceName)` - 获取指定MCP服务的详细信息
- **启动MCP服务**: `StartMCPService(string serviceName)` - 启动指定的MCP服务
- **停止MCP服务**: `StopMCPService(string serviceName)` - 停止指定的MCP服务
- **测试MCP服务**: `TestMCPService(string serviceName)` - 测试指定MCP服务的可用性
- **获取MCP工具列表**: `GetMCPTools(string serviceName)` - 获取指定MCP服务提供的工具列表

#### 7.3 配置管理
- **获取AI配置**: `GetAIConfiguration()` - 获取AI服务配置
- **更新AI配置**: `UpdateAIConfiguration(AIConfig config)` - 更新AI服务配置
- **测试AI连接**: `TestAIConnection(string serviceType)` - 测试AI服务连接

#### 7.4 性能监控
- **监控模型性能**: `MonitorModelPerformance(string modelName)` - 监控指定模型的性能指标
- **监控响应时间**: `MonitorResponseTime(string operationType)` - 监控响应时间
- **监控错误率**: `MonitorErrorRate(string serviceType)` - 监控错误率

#### 7.5 日志管理
- **记录操作日志**: `LogOperation(string operationType, string details, string result)` - 记录操作日志
- **查询错误日志**: `QueryErrorLogs(DateTime startTime, DateTime endTime, string errorType)` - 查询错误日志
- **清理过期日志**: `CleanExpiredLogs(int daysToKeep)` - 清理过期日志

### 8. 接口调用规范

#### 8.1 调用方式
- **同步调用**: 适用于简单、快速的查询操作
- **异步调用**: 适用于耗时的AI分析和文件处理操作
- **批量调用**: 适用于需要处理大量数据的操作

#### 8.2 错误处理
- **重试机制**: 模型推理错误时自动重试，最多3次
- **降级策略**: 当前模型不可用时自动切换到其他可用模型或缓存结果
- **用户提示**: 友好的错误提示和解决建议

#### 8.3 本地优化
- **内存管理**: 及时释放不需要的资源
- **文件缓存**: 缓存常用文件内容

### 2. 服务层
```
Services/
├── FileStorageService.cs        # 文件存储服务
├── RAGService.cs               # RAG知识库服务
├── IndexService.cs             # 全文索引服务
├── SerializationService.cs     # XML/JSON序列化服务
├── KnowledgeBaseService.cs     # 知识库管理服务
├── AIAnalysisService.cs        # AI分析服务
├── WritingGuidanceService.cs   # 写作指导服务
├── FileImportService.cs        # 文件导入服务
├── GenreAnalysisService.cs     # 类型风格分析服务
├── WorldBuildingService.cs     # 世界观构建服务
├── OutlineGenerationService.cs # 大纲生成服务
├── ContentAnalysisService.cs   # 内容分析服务
├── ContentCreationService.cs   # 内容创作服务（集成实时纠错）
├── StructureUpdateService.cs   # 结构更新服务
├── TimelineService.cs          # 时间线管理服务
├── EventManagementService.cs   # 事件管理服务
├── FactionManagementService.cs # 势力管理服务
├── CharacterManagementService.cs # 角色管理服务
├── LogicValidationService.cs   # 逻辑验证服务（集成在创作服务中）
├── FileManagementService.cs    # 文件管理服务
├── VersionControlService.cs    # 版本控制服务
├── ModelManagementService.cs   # 模型管理服务
├── MCPServiceManagementService.cs # MCP服务管理服务
├── AgentCoreService.cs         # AI Agent核心服务
├── WorkflowEngineService.cs    # 工作流引擎服务
├── ContextManagementService.cs # 上下文管理服务
└── ExportImportService.cs      # 导入导出服务
```

### 3. 界面层
```
Views/
├── MainWindow.xaml              # 主窗口
├── KnowledgeBaseView.xaml       # 知识库管理界面
├── AnalysisView.xaml            # 内容分析界面
├── WritingView.xaml             # 写作指导界面
├── GenreAnalysisView.xaml       # 类型风格分析界面
├── WorldBuildingView.xaml       # 世界观构建界面
├── OutlineGenerationView.xaml   # 大纲生成界面
├── ContentCreationView.xaml     # 内容创作界面（集成实时纠错提示）
├── ContentAnalysisView.xaml     # 内容分析界面
├── StructureOverviewView.xaml   # 结构概览界面
├── TimelineView.xaml            # 时间线管理界面
├── EventManagementView.xaml     # 事件管理界面
├── FactionManagementView.xaml   # 势力管理界面
├── CharacterManagementView.xaml # 角色管理界面
├── FileManagerView.xaml         # 文件管理界面
├── ModelManagementView.xaml     # 模型管理界面
└── VersionControlView.xaml      # 版本控制界面
```

## 技术实现概述

详细的技术实现要点请参考 `技术栈与实现方案.md` 文档中的"技术实现要点"章节。

## 项目特色功能

### 1. 智能学习能力
- **持续改进**: 根据用户反馈优化分析算法
- **个性化**: 学习用户的写作偏好和风格
- **知识积累**: 知识库内容越多，分析越准确

### 2. 多维度分析
- **文本层面**: 词汇、句式、修辞等语言特征
- **结构层面**: 情节、章节、段落等组织方式
- **情感层面**: 情绪、氛围、读者体验等效果分析

### 3. 实用性强
- **即时反馈**: 实时提供写作建议和修改建议
- **规范指导**: 将分析结果转化为可操作的写作指导
- **风格保持**: 确保生成内容与目标风格一致
- **流程化创作**: 从类型选择到大纲生成的完整创作流程
- **智能规划**: 根据字数要求智能规划章节结构和内容分配
- **世界观融合**: 支持多作品世界观融合，创造无限可能
- **智能创作**: 基于上下文的智能内容分析和创作指导
- **分段管理**: 智能拆分创作任务，提供分段创作支持
- **动态更新**: 实时更新结构上下文，保持创作连贯性
- **结构管理**: 完整的时间线、事件、势力、角色管理系统
- **关系追踪**: 智能追踪角色发展、事件影响、势力变化
- **实时监控**: 创作过程中实时更新角色状态和情感变化
- **集成式纠错**: 纠错机制完全集成在创作流程中，作为创作思考过程的一部分
- **双栏创作**: 小说内容和AI对话并排显示，创作过程更加直观
- **完全控制**: 用户对所有内容都有完全编辑权限，AI只是辅助工具
- **标准化存储**: 使用通用文件格式，支持脱离程序读写和协作



## 文件系统架构说明

本节原有的小说项目文件结构已迁移至独立文档：`文档/小说工程文件结构设计.md`。

## 总结

这个AI小说写作助手项目将是一个功能丰富、技术先进的本地创作辅助工具。它不仅能够帮助作者提高创作效率和质量，更重要的是能够通过深度分析学习，为作者提供个性化的写作指导。

项目的核心价值在于将AI技术与文学创作相结合，通过智能分析提取写作规律，再将这些规律转化为实用的创作指导，最终实现"AI辅助创作，人类主导创意"的理想状态。

**技术特色**: 采用纯文件+RAG架构，无需数据库，完全基于本地文件系统和向量知识库，支持Ollama中任意用户部署的模型，提供更好的可移植性和用户控制权。采用文件夹结构管理角色、势力、事件等实体，天然支持多媒体文件（图片、音频、视频），为后续功能扩展提供坚实基础。所有数据本地存储，保护用户隐私，完全离线使用。

详细的技术架构、选型和实现方案请参考 `技术栈与实现方案.md` 文档。
