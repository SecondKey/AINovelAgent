# 主窗口设计文档

## 📋 设计概述

**文档用途**: 里程碑1-1主窗口界面设计详细说明  
**设计目标**: 建立清晰、美观、易用的主窗口基础框架  
**设计原则**: 简洁明了、功能分区、易于扩展  

## 🖥️ 主窗口整体布局

### 窗口基本信息
- **窗口标题**: AI小说写作助手
- **窗口尺寸**: 1200x800 (可调整)
- **窗口类型**: 主窗口，支持最大化、最小化、调整大小
- **窗口图标**: 自定义应用图标

### 布局结构
主窗口采用DockPanel布局，从上到下分为以下区域：

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                菜单栏 (MenuBar)                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                工具栏 (ToolBar)                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│                              主内容区域 (MainContent)                           │
│                                                                                 │
│  ┌─────────────┐  ┌─────────────────────────────────┐  ┌─────────────┐        │
│  │             │  │                                 │  │             │        │
│  │  左侧栏     │  │        工作区域                 │  │  右侧栏     │        │
│  │ (SideBar)   │  │      (WorkArea)                │  │ (AIPanel)   │        │
│  │             │  │                                 │  │             │        │
│  │             │  │                                 │  │             │        │
│  │             │  │                                 │  │             │        │
│  │             │  │                                 │  │             │        │
│  └─────────────┘  └─────────────────────────────────┘  └─────────────┘        │
│                                                                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                状态栏 (StatusBar)                              │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**三栏布局说明**:
- **左侧栏 (SideBar)**: 项目导航和快速工具，宽度250px，可折叠
- **工作区域 (WorkArea)**: 中央主要工作区，采用页签形式，支持多页面
- **右侧栏 (AIPanel)**: AI对话和助手功能，宽度300px，可折叠

### 实现现状说明（里程碑1-1）
- 当前已采用 WPF + AvalonDock 实现三栏（左/中/右）可停靠页面框架。
- 为确保稳定性，布局持久化（保存/加载/重置）在本阶段暂时禁用；后续将以代码构建默认布局替代 XML 反序列化。

## 🧭 功能组件详细设计

### 1. 菜单栏 (MenuBar)
**位置**: 窗口顶部，固定高度
**功能**: 提供应用程序的主要功能入口

#### 菜单项结构
- **文件 (File)**
  - 新建项目 (Ctrl+N)
  - 打开项目 (Ctrl+O)
  - 保存项目 (Ctrl+S)
  - 另存为 (Ctrl+Shift+S)
  - 最近项目列表
  - 退出 (Alt+F4)

- **编辑 (Edit)**
  - 撤销 (Ctrl+Z)
  - 重做 (Ctrl+Y)
  - 剪切 (Ctrl+X)
  - 复制 (Ctrl+C)
  - 粘贴 (Ctrl+V)
  - 查找 (Ctrl+F)
  - 替换 (Ctrl+H)

- **视图 (View)**
  - 侧边栏显示/隐藏
  - 工具栏显示/隐藏
  - 状态栏显示/隐藏
  - 全屏模式 (F11)

- **工具 (Tools)**
  - 设置 (Ctrl+,)
  - AI模型管理
  - 知识库管理
  - 分析报告

- **帮助 (Help)**
  - 用户手册
  - 关于 (Ctrl+Shift+A)
  - 检查更新
  - 反馈建议

### 2. 工具栏 (ToolBar)
**位置**: 菜单栏下方，固定高度
**功能**: 提供常用功能的快速访问按钮

#### 工具栏按钮
- **新建项目** - 创建新的写作项目
- **打开文件** - 打开现有文件
- **保存** - 保存当前项目
- **分隔符**
- **AI对话** - 启动AI对话功能
- **文件分析** - 分析当前文件
- **创作指导** - 获取写作建议
- **分隔符**
- **设置** - 打开设置面板
- **帮助** - 显示帮助信息

### 3. 左侧栏 (SideBar)
**位置**: 主内容区域左侧，可折叠
**宽度**: 250px (可调整)
**功能**: 提供项目导航和快速访问

#### 左侧栏内容
- **项目导航**
  - 项目树形结构
  - 文件列表
  - 章节管理
  - 标签分类

- **快速工具**
  - 最近文件
  - 收藏夹
  - 搜索框
  - 工作区切换

- **工作区切换**
  - 写作模式
  - 分析模式
  - 管理模式

### 3.5. 右侧栏 (AIPanel)
**位置**: 主内容区域右侧，可折叠
**宽度**: 300px (可调整)
**功能**: AI对话和智能助手功能

#### 右侧栏内容
- **AI助手状态**
  - 连接状态显示
  - 模型信息
  - 响应时间
  - 在线/离线状态

- **AI对话区域**
  - 对话历史列表
  - 输入框和发送按钮
  - 模型选择器
  - 对话设置

- **智能功能**
  - 快速分析按钮
  - 写作建议
  - 情节发展
  - 角色分析

- **AI设置**
  - 模型参数调整
  - 对话风格设置
  - 历史记录管理
  - 偏好设置

## 🤖 AI对话框设计（新增）

### 1. 位置与结构
- **位置**: 主窗口右侧 AIPanel 内的可停靠窗口（LayoutAnchorable）。
- **结构**:
  - 顶部：对话历史列表（ListBox，支持自动滚动到底部）
  - 底部：输入区（TextBox）+ 发送按钮（Button）

### 2. 交互说明
- 回车发送（Shift+Enter 换行，回车发送）
- 发送时在状态栏显示“发送中...”，完成后显示“就绪”
- 仅实现页面交互骨架；实际AI接入由后续里程碑完成

### 3. 消息样式
- 使用简单气泡样式（灰色背景、圆角）作为占位
- 后续可根据主题调整为左/右对齐、头像与时间戳等

### 4. 后续扩展
- 接入本地 LLM（Ollama）消息发送与流式接收
- 模型选择器与温度等参数
- 会话历史管理与导出

### 4. 主工作区域 (WorkArea)
**位置**: 左侧栏和右侧栏之间，占据剩余空间
**功能**: 主要的操作和显示区域，采用页签形式

#### 工作区域页签系统
- **页签栏 (TabControl)**
  - 支持多页签同时打开
  - 页签可拖拽重新排序
  - 页签可关闭（除最后一个外）
  - 页签标题显示文件名或页面名称

#### 页面类型
- **欢迎页面** (默认显示)
  - 应用Logo和名称
  - 快速开始指南
  - 最近项目列表
  - 功能导航卡片

- **小说编辑页面**
  - 富文本编辑器
  - 格式工具栏
  - 行号显示
  - 滚动条
  - 自动保存提示

- **时间线页面**
  - 时间线可视化
  - 事件节点管理
  - 拖拽排序功能
  - 缩放控制

- **任务卡页面**
  - 任务卡片网格
  - 拖拽排序
  - 状态管理
  - 进度跟踪

- **知识库页面**
  - 文件树形结构
  - 搜索和过滤
  - 分类管理
  - 标签系统

#### 页签管理功能
- **新建页签**: 支持多种页面类型
- **页签切换**: 快捷键Ctrl+Tab
- **页签关闭**: 支持批量关闭
- **页签保存**: 关闭前提示保存
- **页签恢复**: 支持重新打开已关闭页签

### 5. 状态栏 (StatusBar)
**位置**: 窗口底部，固定高度
**功能**: 显示系统状态和进度信息

#### 状态栏内容
- **左侧**: 状态消息、提示信息
- **中间**: 进度条 (需要时显示)
- **右侧**: 当前时间、系统状态

## 🎨 样式设计规范

### 颜色主题
- **主色调**: #2196F3 (Material Design Blue)
- **辅助色**: #FF9800 (Orange)
- **成功色**: #4CAF50 (Green)
- **警告色**: #FFC107 (Amber)
- **错误色**: #F44336 (Red)
- **背景色**: #FAFAFA (Light Gray)
- **文字色**: #212121 (Dark Gray)

### 字体规范
- **标题字体**: Segoe UI, 16px, Bold
- **正文字体**: Segoe UI, 12px, Regular
- **按钮字体**: Segoe UI, 12px, Medium
- **菜单字体**: Segoe UI, 11px, Regular

### 控件样式
- **按钮**: 圆角矩形，悬停效果，阴影
- **输入框**: 简洁边框，聚焦高亮
- **菜单**: 扁平化设计，悬停背景色变化
- **工具栏**: 图标+文字，悬停效果

## 🔧 技术实现要点

### 布局实现
- 使用DockPanel作为主布局容器
- 支持左侧栏和右侧栏折叠/展开
- 响应式设计，支持窗口大小调整
- 使用Grid和StackPanel进行细节布局

### Dock样式限制
- **主布局**: 使用DockPanel实现三栏布局
- **页签停靠**: 只允许工作区内的页签在工作区内停靠
- **侧边栏**: 左侧栏和右侧栏不支持停靠，只能折叠/展开
- **页签管理**: 页签可拖拽重新排序，但不支持跨区域停靠

### 样式实现
- 创建统一的样式资源字典
- 使用主题色变量，便于主题切换
- 实现悬停、聚焦等交互效果
- 支持高DPI显示

### 功能实现
- 菜单项绑定到对应的命令
- 工具栏按钮状态管理
- 侧边栏折叠状态保存
- 工作区域内容切换

## 📱 响应式设计

### 窗口尺寸适配
- **小窗口** (< 800x600): 隐藏侧边栏，简化工具栏
- **中等窗口** (800x600 - 1200x800): 标准布局
- **大窗口** (> 1200x800): 显示更多功能，增加信息密度

### 组件自适应
- 侧边栏宽度可调整
- 工具栏按钮根据宽度自动排列
- 工作区域内容自适应容器大小
- 状态栏信息根据宽度调整显示内容

## ✅ 验收标准

### 界面验收
- [ ] 主窗口正常显示，包含所有设计组件
- [ ] 菜单栏功能完整，快捷键正常工作
- [ ] 工具栏按钮显示正确，功能正常
- [ ] 侧边栏可折叠/展开，内容完整
- [ ] 工作区域内容切换正常
- [ ] 状态栏信息显示正确

### 交互验收
- [ ] 窗口大小调整正常，布局自适应
- [ ] 菜单项点击响应正常
- [ ] 工具栏按钮悬停效果正常
- [ ] 侧边栏折叠/展开动画流畅
- [ ] 快捷键绑定正确

### 样式验收
- [ ] 颜色主题统一，视觉效果良好
- [ ] 字体显示清晰，大小合适
- [ ] 控件样式一致，交互反馈明确
- [ ] 高DPI显示正常

## 🚀 下一步计划

完成主窗口设计后，将按以下顺序实现：

1. **创建基础XAML结构** - 实现DockPanel布局
2. **实现菜单栏** - 创建菜单项和命令绑定
3. **实现工具栏** - 创建工具栏按钮和样式
4. **实现侧边栏** - 创建侧边栏内容和折叠功能
5. **实现工作区域** - 创建欢迎页面和内容切换
6. **实现状态栏** - 创建状态显示和进度条
7. **样式优化** - 应用设计规范，优化视觉效果
8. **功能测试** - 测试所有交互功能

## 📝 注意事项

1. **性能考虑**: 避免过度复杂的布局，保持界面响应性
2. **可访问性**: 支持键盘导航，提供适当的焦点管理
3. **国际化**: 预留文本资源，便于后续多语言支持
4. **主题支持**: 设计支持明暗主题切换的样式系统
5. **扩展性**: 为后续功能模块预留接口和空间
